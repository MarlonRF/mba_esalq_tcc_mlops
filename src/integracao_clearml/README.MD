# MÃ³dulo ClearML - IntegraÃ§Ã£o MLOps

MÃ³dulo completo para rastreamento de experimentos, versionamento de datasets e execuÃ§Ã£o de pipelines com ClearML.

## ğŸ“ Estrutura de Arquivos

```
src/integracao_clearml/
â”œâ”€â”€ __init__.py                          # Exports principais do mÃ³dulo
â”œâ”€â”€ decorators.py                        # Decorators customizados (@pipeline, @component)
â”œâ”€â”€ task_manager.py                      # Gerenciamento de tasks ClearML
â”œâ”€â”€ dataset_manager.py                   # Gerenciamento de datasets versionados
â”œâ”€â”€ registrar_modelo_clearml.py          # Registro standalone de modelos
â”œâ”€â”€ pipeline_completo_decorators.py      # â­ Pipeline completo com @PipelineDecorator
â””â”€â”€ README.md                            # Esta documentaÃ§Ã£o
```

## ğŸ¯ Arquivo Principal

### **pipeline_completo_decorators.py** (636 linhas)

Pipeline MLOps completo usando decorators oficiais do ClearML:
- `@PipelineDecorator.pipeline` - Pipeline orquestrado
- `@PipelineDecorator.component` - Componentes individuais (5 componentes)

**Componentes:**
1. `component_upload_dados_brutos` - Upload de dados brutos como Dataset
2. `component_pipeline_processamento` - Processamento e limpeza
3. `component_pipeline_features` - Engenharia de features
4. `component_pipeline_treinamento` - Treinamento e comparaÃ§Ã£o de modelos
5. `component_registrar_modelo` - Registro do modelo com metadados

**CaracterÃ­sticas:**
- âœ… Cria projeto automaticamente no ClearML
- âœ… 3 datasets versionados (bruto â†’ processado â†’ features)
- âœ… 5 tasks separadas (rastreÃ¡veis)
- âœ… MÃ©trica principal (RÂ²) para decisÃ£o de modelo vigente
- âœ… Artefatos completos (tabelas, grÃ¡ficos, encoders, scalers)
- âœ… ExecuÃ§Ã£o local ou remota

**Uso:**
```python
from src.integracao_clearml.pipeline_completo_decorators import executar_pipeline

resultado = executar_pipeline(
    caminho_csv='dados/arquivo.csv',
    run_locally=True  # True = local, False = remoto
)
```

## ğŸ”§ MÃ³dulos UtilitÃ¡rios

### **decorators.py**
Decorators customizados e utilitÃ¡rios:
- `@pipeline` / `@component` - Wrappers simplificados
- `log_metric()`, `log_artifact()` - Logging
- `ClearMLContext` - Context manager

### **task_manager.py**
Gerenciamento de tasks:
- `criar_task()` - Criar nova task
- `buscar_task_por_nome()` - Buscar task existente
- `registrar_metrica()` - Logar mÃ©tricas
- `registrar_artefato()` - Upload de artefatos

### **dataset_manager.py**
Gerenciamento de datasets:
- `criar_dataset()` - Novo dataset
- `upload_dataset()` - Upload de arquivos
- `baixar_dataset()` - Download de dataset
- `criar_dataset_incremental()` - Versionamento

### **registrar_modelo_clearml.py**
FunÃ§Ã£o standalone para registro de modelos no ClearML com metadados completos.

## ğŸš€ Uso RÃ¡pido

### 1. Pipeline Completo (Recomendado)

```python
from src.integracao_clearml.pipeline_completo_decorators import executar_pipeline

# Executar pipeline completo (local)
resultado = executar_pipeline(
    caminho_csv='dados/arquivo.csv',
    run_locally=True
)

# Resultado contÃ©m:
# - resultado['projeto']
# - resultado['datasets']['bruto']
# - resultado['datasets']['processado']
# - resultado['datasets']['features']
# - resultado['modelo']['id']
# - resultado['modelo']['nome']
# - resultado['modelo']['valor']  # MÃ©trica principal (RÂ²)
```

### 2. Criar Task Manual

```python
from src.integracao_clearml import criar_task, registrar_metrica

task = criar_task(
    project_name="meu_projeto",
    task_name="experimento_01",
    task_type="training"
)

registrar_metrica(task, "accuracy", 0.95, series="treino")
task.close()
```

### 3. Gerenciar Datasets

```python
from src.integracao_clearml import criar_e_publicar_dataset

dataset_id = criar_e_publicar_dataset(
    dataset_name="dados_v1",
    project_name="meu_projeto",
    arquivos=["dados/arquivo.csv"],
    tags=["treinamento", "v1"]
)
```

## ğŸ“Š ComparaÃ§Ã£o de Abordagens

| CaracterÃ­stica | Pipeline Completo (Decorators) | UtilitÃ¡rios Manuais |
|---------------|--------------------------------|---------------------|
| **Uso** | Pipeline end-to-end automÃ¡tico | Controle granular |
| **Datasets** | 3 versionados automaticamente | Manual |
| **Tasks** | 5 tasks criadas automaticamente | 1 task manual |
| **Componentes** | 5 componentes rastreÃ¡veis | CÃ³digo customizado |
| **ExecuÃ§Ã£o** | Local ou remota (fila) | Local apenas |
| **Ideal para** | ProduÃ§Ã£o, reprodutibilidade | Experimentos rÃ¡pidos |

## ğŸ“ Exemplo Completo

```python
# ===================================================================
# PIPELINE COMPLETO - TODAS AS ETAPAS RASTREADAS
# ===================================================================
import sys
sys.path.append('..')

from src.integracao_clearml.pipeline_completo_decorators import executar_pipeline

# Executar pipeline
resultado = executar_pipeline(
    caminho_csv='dados/thermal_confort.csv',
    run_locally=True
)

# Acessar recursos criados
print(f"Projeto: {resultado['projeto']}")
print(f"Dataset bruto: {resultado['datasets']['bruto']}")
print(f"Modelo: {resultado['modelo']['nome']}")
print(f"RÂ²: {resultado['modelo']['valor']:.4f}")

# Visualizar no ClearML UI:
# - http://localhost:8080 (local)
# - https://app.clear.ml (demo)
```

## ğŸ“Œ MÃ©trica Principal

O pipeline usa **RÂ²** como mÃ©trica principal para decisÃ£o de modelo vigente.

**Configurar mÃ©trica (no arquivo pipeline_completo_decorators.py):**
```python
METRICA_PRINCIPAL = "R2"  # Para regressÃ£o
# ou
METRICA_PRINCIPAL = "Accuracy"  # Para classificaÃ§Ã£o
```

## ğŸ—‘ï¸ Arquivos Removidos (Limpeza Realizada)

Os seguintes arquivos foram removidos por serem redundantes ou deprecados:

1. âŒ `clearml_project.py` - Deprecado (funcionalidade em task_manager/dataset_manager)
2. âŒ `pipeline_processamento_clearml.py` - SubstituÃ­do por pipeline_completo_decorators.py
3. âŒ `pipeline_treinamento_clearml.py` - SubstituÃ­do por pipeline_completo_decorators.py
4. âŒ `pipeline_completo_clearml.py` - SubstituÃ­do por pipeline_completo_decorators.py

**Resultado:** Estrutura mais limpa e focada no arquivo principal `pipeline_completo_decorators.py`.

## ğŸ“š DocumentaÃ§Ã£o Adicional

- **ClearML Docs**: https://clear.ml/docs
- **PipelineDecorator**: https://clear.ml/docs/latest/docs/pipelines/pipelines
- **ConfiguraÃ§Ã£o**: `config/config_clearml.py`

## âœ… Status

- âœ… MÃ³dulo limpo e organizado (7 arquivos)
- âœ… Pipeline principal com decorators oficiais
- âœ… UtilitÃ¡rios para uso manual
- âœ… DocumentaÃ§Ã£o completa
- âœ… Pronto para produÃ§Ã£o
